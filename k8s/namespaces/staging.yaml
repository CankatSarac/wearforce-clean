apiVersion: v1
kind: Namespace
metadata:
  name: staging
  labels:
    name: staging
    environment: staging
    managed-by: helm
    istio-injection: enabled
  annotations:
    wearforce-clean.io/description: "Staging environment for WearForce application"
    wearforce-clean.io/team: "platform"
    wearforce-clean.io/cost-center: "engineering"

---
# Resource Quota for staging environment
apiVersion: v1
kind: ResourceQuota
metadata:
  name: staging-quota
  namespace: staging
spec:
  hard:
    requests.cpu: "50"
    requests.memory: 100Gi
    limits.cpu: "80"
    limits.memory: 160Gi
    requests.nvidia.com/gpu: "4"
    persistentvolumeclaims: "30"
    pods: "100"
    services: "30"
    secrets: "100"
    configmaps: "100"

---
# Limit Range for pod resources
apiVersion: v1
kind: LimitRange
metadata:
  name: staging-limits
  namespace: staging
spec:
  limits:
  - default:
      cpu: "2"
      memory: "4Gi"
    defaultRequest:
      cpu: "200m"
      memory: "256Mi"
    type: Container
  - max:
      cpu: "8"
      memory: "16Gi"
    min:
      cpu: "100m"
      memory: "128Mi"
    type: Container
  - max:
      storage: "100Gi"
    min:
      storage: "1Gi"
    type: PersistentVolumeClaim

---
# Network Policy for staging environment
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: staging-network-policy
  namespace: staging
spec:
  podSelector: {}
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          name: staging
    - namespaceSelector:
        matchLabels:
          name: istio-system
    - namespaceSelector:
        matchLabels:
          name: monitoring
    # Allow ingress from load balancer
    - namespaceSelector: {}
      podSelector:
        matchLabels:
          app: nginx-ingress-controller
  egress:
  - to: []  # Allow all egress
  # Specific egress rules can be added for better security